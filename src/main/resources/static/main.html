<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <link href="/css/theme.css" rel="stylesheet">
  <link href="/css/bootstrap-theme.min.css" rel="stylesheet">
  <link href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
  <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <script src="https://cdn.staticfile.org/vue/2.2.2/vue.min.js"></script>
  <script src="/js/data.js"></script>
  <title>管理</title>
</head>
<body>
<div id="app">
  <!-- 顶部导航栏 -->
  <nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
                aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="">管理</a>
      </div>
      <div id="navbar" class="navbar-collapse collapse">
        <ul class="nav navbar-nav">
          <li :class="data.show.tab===0?'active':''"><a @click="setTab(0)">
            <span class="glyphicon glyphicon-bed"></span>用户管理</a></li>
          <li :class="data.show.tab===1?'active':''"><a @click="setTab(1)">
            <span class="glyphicon glyphicon-book"></span>就诊记录</a></li>
          <li :class="data.show.tab===2?'active':''"><a @click="setTab(2)">
            <span class="glyphicon glyphicon-user"></span>患者管理</a></li>
          <li :class="data.show.tab===3?'active':''"><a @click="setTab(3)">
            <span class="glyphicon glyphicon-user"></span>医生管理</a></li>
          <li :class="data.show.tab===4?'active':''"><a @click="setTab(4)">
            <span class="glyphicon glyphicon-wrench"></span>科室管理</a></li>
        </ul>
        <ul class="nav navbar-nav navbar-right">
          <li>
            <a>
              <span class="glyphicon glyphicon-envelop"></span>{{data.user.username}}
            </a>
          </li>
          <li>
            <a @click="logout()"><span class="glyphicon glyphicon-log-out"></span> 退出</a>
          </li>
        </ul>
      </div><!--/.nav-collapse -->
    </div>
  </nav>

  <div class="container theme-showcase" role="main">
    <!-- 列表显示区 -->
    <div v-if="data.show.func===0">
      <div class="col-md-12">
        <table class="table table-striped">
          <thead>
          <tr>
            <th v-for="title in data.titles[data.show.tab]">{{title}}</th>
            <th>
              <button class="btn btn-sm btn-info" @click="create()">添加</button>
              <button class="btn btn-sm btn-success" @click="loadList()">刷新</button>
            </th>
          </tr>
          </thead>
          <tbody>
          <tr v-for="i in data.list">
            <td v-for="j in i">{{j}}</td>
            <td>
              <button class="btn btn-sm btn-info" @click="edit(i.id)">编辑</button>
              <button class="btn btn-sm btn-danger" @click="remove(i.id)">删除</button>
            </td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <script>
    let app = new Vue({
      el: "#app",
      data: {data, url},
      methods: {
        // 全局操作
        setTab(tab) {
          if (this.data.show.func === 0) {
            this.data.show.tab = tab;
          }
        },
        logout() {
          jQuery.get(this.url.logout).then(res => {
            if (res) window.location.href = this.url.root;
          });
        },
        loadList() {
          jQuery.get(this.url.findAll(this.data.show.tab)).then(res => {
            this.data.list = JSON.parse(res);
          });
        },
        // 实体操作
        edit(id) {
          this.data.show.func = 1;
          this.loadEntity(id);
        },
        create() {
          this.data.show.func = 1;
          this.data.entity = {};
        },
        loadEntity(id) {
          jQuery.get(this.url.findOne(this.data.show.tab) + id).then(res => {
            this.data.entity = JSON.parse(res);
          });
        },
        remove(id) {
        }
      },
      created() {
        this.loadList();
      }
    });
  </script>
</body>
</html>